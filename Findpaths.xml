<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Monday, January 09, 2023, 6:45 PM -->
<!-- MuClient version 5.07-pre -->

<!-- Plugin "Broadcast_Reader" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Findpaths"
   author="Gaballon"
   id="47fb5e884bc3f2c6d95e3ac9"
   language="Lua"
   purpose="Find path distances to all valid quest/campaign areas."
   save_state="y"
   date_written="2023-02-14 18:44:40"
   requires="5.07"
   version="1.0"
   >

</plugin>

<triggers>
</triggers>

<aliases>

  <alias
   match="^findpaths$"
   enabled="y"
   regexp="y"
   script="findpaths"
   sequence="100"
  ></alias>
  
</aliases>

<script>
<![CDATA[

require "tprint"
require "gmcphelper"
local aard_lua_extras = require "aard_lua_extras"

local version = assert(aard_lua_extras.PackageVersion()) or 0
local dest = ""
local report = {}
local findingpaths = false
local areas = {
	["aardington"] = {start = "47509"}, -- A --
    ["academy"] = {start = "35233"},
    ["adaldar"] = {start = "34400"},
    ["afterglow"] = {start = "38134"},
    ["agroth"] = {start = "11027"},
    ["ahner"] = {start = "30129"},
    ["alehouse"] = {start = "885"},
    ["amazon"] = {start = "1409"},
    ["amusement"] = {start = "29282"},
    ["andarin"] = {start = "2399"},
    ["annwn"] = {start = "28963"},
    ["anthrox"] = {start = "3993"},
    ["arboretum"] = {start = "39100"},
    ["arena"] = {start = "25768"},
    ["arisian"] = {start = "28144"},
    ["ascent"] = {start = "43150"},
    ["asherodan"] = {start = "37400", vidblain = true},
    ["astral"] = {start = "27882"},
    ["atlantis"] = {start = "10573"},
    ["autumn"] = {start = "13839"},
    ["avian"] = {start = "4334"},
    ["bazaar"] = {start = "34454"}, -- B --
    ["beer"] = {start = "20062"},
    ["believer"] = {start = "25940"},
    ["blackrose"] = {start = "1817"},
    ["bliss"] = {start = "29988"},
    ["bonds"] = {start = "23411"},
    ["caldera"] = {start = "26341"}, -- C --
    ["callhero"] = {start = "33031"},
    ["camps"] = {start = "4714"},
    ["canyon"] = {start = "25551"},
    ["caravan"] = {start = "16071"},
    ["cards"] = {start = "6255"},
    ["carnivale"] = {start = "28635"},
    ["cataclysm"] = {start = "19976"},
    ["cathedral"] = {start = "27497"},
    ["cats"] = {start = "40900"},
	["chakra"] = {start = "39358"},
    ["chasm"] = {start = "29446"},
    ["chessboard"] = {start = "25513"},
    ["childsplay"] = {start = "678"},
    ["cineko"] = {start = "1507"},
    ["citadel"] = {start = "14963"},
    ["conflict"] = {start = "27711"},
    ["coral"] = {start = "4565"},
    ["cougarian"] = {start = "14311"},
    ["cove"] = {start = "49941"},
    ["cradle"] = {start = "11267"},
    ["crynn"] = {start = "43800"},
    ["damned"] = {start = "10469"}, -- D --
    ["darklight"] = {start = "19642", vidblain = true},
    ["darkside"] = {start = "15060"},
    ["ddoom"] = {start = "4193"},
    ["deadlights"] = {start = "16856"},
    ["deathtrap"] = {start = "1767"},
    ["deneria"] = {start = "35006"},
    ["desert"] = {start = "20186"},
    ["desolation"] = {start = "19532"},
    ["dhalgora"] = {start = "16755"},
    ["diatz"] = {start = "1254"},
    ["diner"] = {start = "36700"},
    ["dortmund"] = {start = "16577"},
    ["drageran"] = {start = "25894"},
    ["dread"] = {start = "26075"},
    ["dsr"] = {start = "30030"},
    ["dundoom"] = {start = "25661"},
    ["dunoir"] = {start = "14222"},
    ["duskvalley"] = {start = "37301"},
    ["dynasty"] = {start = "30799"},
    ["earthlords"] = {start = "42000"}, -- E --
    ["earthplane"] = {start = "1354"},
    ["elemental"] = {start = "41624"},
    ["empire"] = {start = "32203"},
    ["empyrean"] = {start = "14042"},
    ["entropy"] = {start = "29773"},
    ["fantasy"] = {start = "15205"}, -- F --
    ["farm"] = {start = "10676"},
    ["fayke"] = {start = "30418"},
    ["fens"] = {start = "16528"},
    ["fields"] = {start = "29232"},
    ["firebird"] = {start = "32885"},
    ["firenation"] = {start = "41879"},
    ["fireswamp"] = {start = "34755"},
    ["fortress"] = {start = "31835"},
    ["fortune"] = {start = "38561"},
    ["fractured"] = {start = "17033"},
    ["ft1"] = {start = "1205"},
    ["ftii"] = {start = "26673"},
    ["gallows"] = {start = "4344"}, -- G --
    ["gathering"] = {start = "36451"},
    ["gauntlet"] = {start = "31652"},
    ["gilda"] = {start = "4243"},
    ["glamdursil"] = {start = "35055"},
    ["glimmerdim"] = {start = "26252"},
    ["gnomalin"] = {start = "34397"},
    ["goldrush"] = {start = "15014"},
    ["graveyard"] = {start = "28918"},
    ["greece"] = {start = "2089"},
    ["gwillim"] = {start = "25974"},
    ["hades"] = {start = "29161"}, -- H --
    ["hatchling"] = {start = "34670"},
    ["hawklord"] = {start = "40550"},
    ["hedge"] = {start = "15146"},
    ["helegear"] = {start = "30699"},
    ["hell"] = {start = "30984"},
    ["hoard"] = {start = "1675"},
    ["hodgepodge"] = {start = "30469"},
    ["horath"] = {start = "91"},
    ["horizon"] = {start = "31959"},
    ["illoria"] = {start = "10420"},
    ["imagi"] = {start = "36800"}, -- I --
    ["imperial"] = {start = "16966", vidblain = true},
    ["infamy"] = {start = "26641"},
    ["infest"] = {start = "16165"},
    ["insan"] = {start = "6850"},
    ["jenny"] = {start = "29637"}, -- J --
    ["jotun"] = {start = "31508"},
    ["kearvek"] = {start = "29722"}, -- K --
    ["kerofk"] = {start = "16405"},
    ["ketu"] = {start = "35114"},
    ["kingsholm"] = {start = "27522"},
    ["knossos"] = {start = "28193"},
    ["kobaloi"] = {start = "10691"},
    ["kultiras"] = {start = "31161"},
    ["lab"] = {start = "28684"}, -- L --
    ["labyrinth"] = {start = "31405"},
    ["lagoon"] = {start = "30549"},
    ["landofoz"] = {start = "510"},
    ["laym"] = {start = "6005"},
    ["legend"] = {start = "16224"},
    ["lemdagor"] = {start = "1966"},
    ["lidnesh"] = {start = "27995"},
    ["livingmine"] = {start = "37008"},
    ["longnight"] = {start = "26367"},
    ["losttime"] = {start = "28584"},
    ["lowlands"] = {start = "28044"},
    ["lplanes"] = {start = "29364"},
    ["maelstrom"] = {start = "38058"}, -- M --
    ["manor"] = {start = "10621"},
    ["masq"] = {start = "29840"},
    ["mayhem"] = {start = "1866"},
    ["melody"] = {start = "14172"},
    ["minos"] = {start = "20472"},
    ["mistridge"] = {start = "4491"},
    ["monastery"] = {start = "15756"},
    ["mudwog"] = {start = "2347"},
    ["nanjiki"] = {start = "11203"}, -- N --
    ["necro"] = {start = "29922"},
    ["nenukon"] = {start = "31784"},
    ["newthalos"] = {start = "23853"},
    ["ninehells"] = {start = "4613"},
    ["northstar"] = {start = "11127"},
    ["nottingham"] = {start = "11077"},
    ["nulan"] = {start = "37900"},
    ["nursing"] = {start = "31977"},
    ["nynewoods"] = {start = "23562"},
    ["oceanpark"] = {start = "39600"}, -- O --
    ["omentor"] = {start = "15579", vidblain = true},
    ["ooku"] = {start = "39000"},
    ["origins"] = {start = "35900"},
    ["orlando"] = {start = "30331"},
    ["paradise"] = {start = "29624"}, -- P --
    ["partroxis"] = {start = "5814"},
    ["peninsula"] = {start = "35701"},
    ["petstore"] = {start = "995"},
    ["pompeii"] = {start = "57"},
    ["promises"] = {start = "25819"},
    ["prosper"] = {start = "28268"},
    ["qong"] = {start = "16115"}, -- Q --
    ["quarry"] = {start = "23510"},
    ["radiance"] = {start = "19805"}, -- R --
    ["raga"] = {start = "19861"},
    ["raukora"] = {start = "6040"},
    ["rebellion"] = {start = "10305"},
    ["remcon"] = {start = "25837"},
    ["reme"] = {start = "32703"},
    ["rosewood"] = {start = "6901"},
    ["ruins"] = {start = "16805"},
    ["sagewood"] = {start = "28754"}, -- S --
    ["sahuagin"] = {start = "34592"},
    ["salt"] = {start = "4538"},
    ["sanctity"] = {start = "10518"},
    ["sanctum"] = {start = "15307"},
    ["sandcastle"] = {start = "37701"},
    ["sanguine"] = {start = "15436"},
    ["scarred"] = {start = "34036"},
    ["sendhian"] = {start = "20288", vidblain = true},
    ["sennarre"] = {start = "15491"},
    ["shadowsend"] = {start = "40096"},
    ["shouggoth"] = {start = "34087"},
    ["siege"] = {start = "43265"},
    ["sirens"] = {start = "16298"},
    ["slaughter"] = {start = "1601"},
    ["snuckles"] = {start = "182"},
    ["soh"] = {start = "25611"},
    ["sohtwo"] = {start = "30752"},
    ["solan"] = {start = "23713"},
    ["songpalace"] = {start = "47013"},
    ["spyreknow"] = {start = "34800"},
    ["stone"] = {start = "11386"},
    ["storm"] = {start = "6304"},
    ["stormhaven"] = {start = "20649"},
    ["stronghold"] = {start = "20572"},
    ["stuff"] = {start = "40400"},
    ["takeda"] = {start = "15952"}, -- T --
    ["talsa"] = {start = "26917"},
    ["temple"] = {start = "31597"},
    ["tanra"] = {start = "46913"},
    ["terra"] = {start = "19679"},
    ["terramire"] = {start = "4493"},
    ["thieves"] = {start = "7"},
    ["tilule"] = {start = "39771"},
    ["times"] = {start = "28463"},
    ["tirna"] = {start = "20136"},
    ["titan"] = {start = "38234"},
    ["tol"] = {start = "16325"},
    ["tombs"] = {start = "15385"},
    ["umari"] = {start = "36601"}, -- U --
    ["underdark"] = {start = "27341"},
    ["uplanes"] = {start = "29364"},
    ["uprising"] = {start = "15382"},
    ["vale"] = {start = "1036"}, -- V --
    ["verdure"] = {start = "24090"},
    ["verume"] = {start = "30607"},
    ["village"] = {start = "30850"},
    ["vlad"] = {start = "15970"},
    ["volcano"] = {start = "6091"},
    ["weather"] = {start = "40499"}, -- W --
    ["werewood"] = {start = "30956"},
    ["wildwood"] = {start = "322"},
    ["winter"] = {start = "1306"},
    ["wizards"] = {start = "31316"},
    ["wonders"] = {start = "32981"},
    ["wooble"] = {start = "11335"},
    ["woodelves"] = {start = "32199"},
    ["wtc"] = {start = "37895"},
    ["wyrm"] = {start = "28847"},
    ["xmas"] = {start = "6212"}, -- X --
    ["xylmos"] = {start = "472"},
    ["yarr"] = {start = "30281"},
    ["ygg"] = {start = "24186"}, -- Y --
    ["yurgach"] = {start = "29450"},
    ["zangar"] = {start = "6164"}, -- Z --
    ["zodiac"] = {start = "15857"},
    ["zoo"] = {start = "5920"},
    ["zyian"] = {start = "729"}
}

function findpaths(name, line, wildcards)
	if tonumber(version) < 2249 then
		ColourNote("red", "", "Your Aard MUSH package needs to be updated!")
		return
	end
	local k, v = "", ""
	report = {}
	print("Finding paths to areas...")
	findingpaths = true
	for k, v in pairs(areas) do
		local aid = k
		local rid = v.start
		report[tostring(rid)] = {area = aid, distance = nil}
		dest = tostring(rid)
		CallPlugin("b6eae87ccedd84f510b74714", "findpath", "32418", rid)
	end
	display_report()
end

function display_report()
	local sorted = {}
	local deleted = {}
	if next(report) == nil then
		print("Report table is blank.")
	else
		table.foreach(report, function(k, v) if v["distance"] ~= nil then table.insert(sorted, { area = v["area"], distance = v["distance"] }) else table.insert(deleted, v["area"]) end end)
		table.sort(sorted, function(k1, k2) return k1.distance < k2.distance end)
		local i = 0		
		for _, val in ipairs(sorted) do
			i = i + 1
			local line = string.format("|%3i|  Area: %10s    Distance: %3i", i, val.area, val.distance)
			ColourNote("palegreen", "", line)
		end
		if next(deleted) ~= nil then
			ColourNote("red", "", "Unable to find a paths to:")
			local i = 0
			for _, value in ipairs(deleted) do
				i = i + 1
				local line = string.format("|%3i|  Area: %10s    Distance: unknown", i, value)
				ColourNote("red", "", line)
			end
		else
			print("Paths found to all areas!")
		end
	end
	findingpaths = false
end

function OnPluginBroadcast (msg, id, name, text)
	if ((id == "b6eae87ccedd84f510b74714" and msg==502) and (findingpaths == true)) then -- aard_gmcp_mapper
		luastmt = text
        assert(loadstring (luastmt or "")) ()  		
		local d = table.maxn(found_paths)
		report[dest]["distance"] = d
	end
end

]]>
</script>

</muclient>
